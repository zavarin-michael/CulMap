{% extends "map/master.html" %}
{% load static %}
{% block content %}


    <script src="https://api-maps.yandex.ru/2.1/?apikey=ccd08e6c-baa4-4ccd-bb52-405b31957b32&lang=ru_RU" type="text/javascript"></script>

    <script>

    ymaps.ready(initMap);

    function initMap() {

        var pos = [56.832040, 60.598218];

        var opt = {
            center: pos,
            zoom: 10,
            controls: []
        };


        var map = new ymaps.Map("map", opt, );

        marker = [];
        info = [];
        let i = 1;
        var mas = [];

        {% for mark in marks %}

            mas[i] = {
                "id": {{ mark.id }},
                "posx": {{ mark.position_x }},
                "posy": {{ mark.position_y }},
                "comment": "{{ mark.comment }}",
                "name": "{{ mark.name }}",
            };

            i++;
        {% endfor %}

        for(let j = 1; j < i; j++) {

            marker[j] = new ymaps.GeoObject({
                geometry: {
                type: "Point",
                coordinates: [mas[j]["posx"], mas[j]["posy"]]
                }
            });

            marker[j].events.add('click', function (event) {

                event.preventDefault();
                var $this = $(this);

                if (!$('#section-info').hasClass('info-section-open')) {
                    $('body').toggleClass('offcanvas-info');
                    $('#section-info').toggleClass('info-section-open');
                }

                location.href = "http://127.0.0.1:8050/?"+mas[j]["id"];
            });

            map.geoObjects.add(marker[j]);
        }

        var id = {{ id }};

        if (id > -1){
            var name = document.getElementById("name");
            var text = document.createTextNode(mas[id]["name"]);
            name.appendChild(text);
        }
    }

    </script>



{% endblock content %}